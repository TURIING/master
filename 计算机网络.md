### 第1章 计算机网络体系结构

`计算机网络的功能`

1⃣️ **数据通信**   ==计算机网络中最基本、最重要的功能==		2⃣️ **资源共享**  可以是==软件、数据、硬件共享==

3⃣️ **分布式处理**（多台计算机各自承担同一工作任务的不同部分）

4⃣️ **提高可靠性**			5⃣️ **负载均衡**

`计算机网络的组成`

* **从组成部分上看**

    一个完整的计算机网络主要由==硬件、软件、协议==三部分组成

* **从工作方式上看**

    * **边缘部分**

    	<u>由所有连接到因特网上、供用户直接使用的主机组成</u>（个人设备）

    * **核心部分**

    	<u>由大量的网络和连接这些网络的路由器组成</u>，为边缘部分提供连通性和交换服务

* **从功能组成上看**

    * **通信子网**

      <u>由各种传输介质、通信设备和相应的网络协议组成</u>（**实现数据通信**）

      ==网桥、交换机、路由器==

    * **资源子网**
    
    	<u>是实现资源共享功能的设备及其软件的集合</u>（**实现资源共享/数据处理**）

<img src="计算机网络.assets\image-20211024195702183.png" alt="image-20211024195702183" style="zoom: 45%;" />

`计算机网络的分类`

* **按分布范围**

    1⃣️ **广域网**（WAN）==使用交换技术==    		2⃣️ **城域网**（MAN）**大多采用以太网技术**

    3⃣️ **局域网**（LAN）==采用广播技术==			  4⃣️ **个人区域网**（PAN）

    ==广域网和局域网之间的差异不仅在于它们所覆盖的范围不同，还在于它们所采用的协议和网络技术的不同==

    （<u>故在较小范围内布置的不一定是局域网，较大范围内布置的不一定是广域网</u>）

    城域网可视为为了满足一定的区域需求，而将多个局域网互联的局域网

    **局域网与广域网的互联是通过路由器来实现的**

* **按使用者**

    1⃣️ **公用网**   电信公司出资建造的大型网络

    2⃣️ **专用网**   某个部门为满足本单位特殊业务的需要而建造的网络

* **按交换技术**

    1⃣️ 电路交换网络 		2⃣️ 报文交换网络 		3⃣️ 分组交换网络

* **按拓扑结构**

<img src="计算机网络.assets\image-20211024200606697.png" alt="image-20211024200606697" style="zoom: 45%;" />

​		==星形、总线形、环形网络多用于局域网==、==网状网络多用于广域网==；==星型、环型、树型存在单点故障问题==

​		**计算机网络拓扑结构主要取决于它的通信子网**；		==$在n个结点的星形拓扑结构中，有n-1条物理链路$==

* **按传输技术**

    * **广播式网络** 

      ==广域网中的无线、卫星通信网络也采用广播式通信技术==

      ==广播式网络共享广播信道、不存在路由选择问题、可以不要网络层==

    * **点对点网络**
    
    	==使用分组存储转发和路由选择机制==，**广域网基本都属于点对点网络**

`计算机网络的性能指标`

* **速率**

​		也称__数据传输速率、数据率、比特率__；单位b/s；<u>通常把最高数据传输速率称为带宽</u>

* **带宽**

​		表示网络的通信线路传送数据的能力，通常是单位时间内从网络中的某一点到另一点所能通过的最高数据率，单位b/s

* **吞吐量**

​		表示单位时间内通过某个网络的数据量；单位b/s、kb/s等

* **时延**

​		==$发送时延 = \frac{数据长度}{信道宽度（发送速率）}$==、==$传播时延 = \frac{信道长度}{电磁波在信道上的传播速率}$==

​		==$总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延$==

* **时延带宽积**

​		（某段链路上有多少比特，即容量，单位bit）

​		==$时延带宽积 = 传播时延 \times 信道带宽$==

* **往返时延RTT**

​		（表示从发送方发送数据开始，到发送方收到接收方的确认总共经历的时延）

​		==$RTT=传播时延\times 2+末端处理时间$==

* **信道利用率**

​		（指某一信道有百分之多少的时间是有数据通过的）

​		==$信道利用率 = \frac{有数据通过时间}{（有+无）数据通过时间}$==

`分层结构`

**实体**:  第n层的活动元素，指任何可发送或接收信息的硬件或软件进程

**对等层**:  不同机器上的同一层

**对等实体**:  同一层的实体

**协议**:  为进行网络中的对等实体数据交换而建立的规则、标准或约定(==不对等实体间没有协议==)

​			  协议由语法、语义、同步三部分组成：

​			  1⃣️ ==语法规定了传输数据的格式==

​			  2⃣️ ==语义规定了所要完成的功能，即需要发出何种控制信息、完成何种动作及做出何种应答==

​			  3⃣️ ==同步规定了执行各种操作的条件、时序关系==

**接口（访问服务点SAP）**：上层使用下层服务的入口（同一结点内==相邻两层间==交换信息的连接点）

​				==物理层（网卡接口）、数据链路层（MAC地址/网卡地址）、网络层（IP地址、网络地址）==

​				==传输层（端口号）、应用层（用户界面）==

**服务**：指==下层为紧邻的上层提供的功能调用==

​				**服务数据单元（SDU）**：为完成用户所要求的功能而应传送的数据

​				**协议控制信息（PCI）**：控制协议操作的信息

​				**协议数据单元（PDU）**：对等层次之间传送的数据单元

​				==PDU = PCI + SDU==

​				 **第n层在向n+1层提供服务时，此服务不仅包含第n层本身的功能，还包含下层服务提供的功能**

**分层的目的不包括定义功能执行的具体方法**

`OSI参考模型`

==世界上出现最早的计算机网络是ARPAnet==

<img src="计算机网络.assets\image-20211025142216381.png" alt="image-20211025142216381" style="zoom:30%;" />

* **表示层**

    ==数据格式变换、数据加密解密、数据压缩和恢复==

* **会话层**

    （向表示层实体/用户进程提供建立连接并在连接上有序地传输数据）

    ==建立、管理、终止会话==

    ==使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信，实现数据同步==

* **传输层**

    （负责主机中两个进程之间的通信，即**端到端的通信**）

    ==传输单位是报文段（TCP）和用户数据报（UDP）==

    ==可靠传输、不可靠传输==，==差错控制==，==流量控制==，==复用分用==

    **复用**：多个应用层进程可同时使用下面运输层的服务		**分用**：运输层把收到的信息分别交付给上面应用层中相应的进程

* **网络层**

    （主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务）

    ==传输单位：数据报/分组==（二者父与子的关系）

    ==路由选择==，==流量控制==，==差错控制==，==拥塞控制==

    （若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态，因此要采取一定措施缓解这种拥塞）

* **数据链路层**

    主要任务是把**网络层传下来的数据报组装成帧**（==传输单位：帧==）

    ==为网络层提供服务==（无确认无连接服务、有确认无连接服务、有确认面向连接服务）

    ==链路管理==（连接的建立、维持、释放，只用于面向连接的服务）

    ==封装成帧和透明传输==，==差错控制==，==流量控制==，==访问控制（控制对信道的访问）==

* **物理层**

    主要任务是在物理媒体上**实现比特流的透明传输**（==传输单位：比特==）

    ==定义接口特性==，==定义传输模式==（单工、半双工、双工）

    ==定义传输速率==，==比特同步==，==比特编码==

**流量控制只存在于数据链路层及其之上**

`TCP/IP参考模型`

**实际执行的国际标准是TCP/IP标准**

<img src="计算机网络.assets\image-20211025145913489.png" alt="image-20211025145913489" style="zoom: 33%;" />

<img src="计算机网络.assets\image-20211025145425457.png" alt="image-20211025145425457" style="zoom: 40%;" />

<img src="计算机网络.assets\image-20211025150001272.png" alt="image-20211025150001272" style="zoom: 33%;" />

### 第2章 物理层

**通信的目的**：==传送消息==（语音、文字、图像、视频等）

`接口特性`

* **机械特性**

    定义物理连接的特性，规定物理连接时所采用的==规格、接口形状、引线数目、引脚数量==

* **电气特性**

    规定传输二进制位时，线路上信号的==电压范围、阻抗匹配、传输速率和距离限制==

* **功能特性**

    指明某条线上出现的==某一电平表示何种意义==，接口部件的信号线的用途

* **规程特性**

    也称<u>过程特性</u>，定义各条物理线路的==工作规程和时序关系==

`信源、信道与信宿`

__信源__：产生和发送数据的源头								__信宿__：接收数据的终点

__信道__：信号的传输媒介，==一条通信线路包含一条发送信道和一条接收信道==

​				**按传输信号分为**：<u>模拟信道</u>（传输模拟信号）、<u>数字信道</u>（传输数字信号）		**按传输介质分为**：<u>无线信道、有线信道</u>

<img src="计算机网络.assets/截屏2022-08-19 21.25.43.png" alt="截屏2022-08-19 21.25.43" style="zoom:50%;" />

`三种通信方式`

__单工通信__：只有一个方向的通信而没有反方向的交互，==需要一条信道==

__半双工通信__：通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收，==需要两条信道==

__全双工通信__：通信双方可以同时发送和接收信息，==需要两条信道==

`数据传输方式`

__串行传输__：==速度慢、费用低、适合远距离==	__并行传输__：==速度快、费用高、适合近距离==（用于计算机内部的数据传输）

**同步传输**（区块传输）：数据的传送是以一个数据区块为单位，在传送数据时，需先送出一个或多个同步字符，再送出整批的数据

**异步传输**：将比特分成小组进行传送；传送数据时，加一个字符起始位和一个字符终止位；发送方可以在任何时刻发送这些比特

​		 				组，而接收方不知道它们会在什么时候到达

`码元`

用一个固定时长的信号波形代表不同离散数值的基本波形，**1码元可以携带多个比特的信息量**（==$N进制码元携带log_2N比特$==）

==一个码元所取的有效离散值个数为$n=2^k$（一个码元携带k比特的信息量）==

`速率`

也称数据率，指数据的传输速率，表示<u>单位时间内传输的数据量</u>，可用码元传输速率和信息传输速率表示

* __码元传输速率__

    也称__波特率、调制速率、波形速率、符号速率__

    表示单位时间内数字通信系统所传输的码元个数（也可称为脉冲个数或==信号变化的次数==）

    单位：__波特（Baud）__；1波特表示每秒传输一个码元；==码元速率与进制数无关，只与码元长度有关==

    <u>在数值上，波特率等于比特率与每符号所含的比特数的比值</u>

* __信息传输速率__

    又称__信息速率、比特率__，表示单位时间内数字通信系统传输二进制码元个数（即比特数）；**单位**：比特/秒（b/s）
    
    **信息传输速率实际上是信号的发送速率**

​		 ==$若一个码元携带n比特的信息量，则M波特率的码元传输速率所对应的信息传输速率为Mn比特/秒$==

​		 ==$采样速率=n\times m（b/s，采样n次/s，m=log_2V）；数据传输率\le 采样速率$==

<img src="计算机网络.assets\image-20211025214901504.png" alt="image-20211025214901504" style="zoom: 50%;" />

<img src="计算机网络.assets\image-20211025215119971.png" alt="image-20211025215119971" style="zoom:50%;" />

`奈奎斯特定理与香农定理`

**影响失真程度的因素**：1⃣️ 码元传输速率 2⃣️ 信号传输距离 3⃣️ 噪声干扰 （前三种为正相关）4⃣️ 传输媒体质量（负相关）

**码间串扰**：接收端收到的信号波形失去了码元之间清晰界限的现象

* __奈奎斯特定理__

    __在理想低通（没有噪声、带宽有限）的信道中，为了避免码间串扰，极限码元传输速率为2W波特__（W是信道带宽，单位Hz）

    ==理想低通信道下的极限数据传输速率 = $2Wlog_2V$==（b/s）（V为每个码元离散电平的数目，即几种码元）

    （**V的常见说法**：<u>信道中每个信号包含V级</u>；<u>采用n种相位，每种相位各有m种幅度的QAM调制方法，即V = mn</u>）

    ​									 <u>采用V相位调制</u>

    **结论**： 1⃣️ __在任何信道中，码元传输速率是有上限的__

    ​			    2⃣️ **信道的频带越宽，就可以用更高的速率进行码元的有效传输**（即W越大，数据传输速率越大）

    ​			    3⃣️ **奈氏准则给出了码元传输速率的限制，但并未对数据传输速率给出限制**

    ​			 		（即要提高数据传输速率就设法使每个码元携带更多比特的信息量）

* __香农定理__

    ==$信道的极限数据传输速率 = Wlog_2(1+S/N)$==(b/s)

    ==$信噪比（dB） = 10log_{10}(S/N)$==（W:信道的带宽；S:信道所传输信号的平均功率；N:信道内部的高斯噪声功率）

    结论： 1⃣️ **信道的带宽或信道的信噪比越大，则信息的极限传输速率就越高**

    ​				2⃣️ <u>对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了</u>
    
    ​				3⃣️ **只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输**
    
    ​				4⃣️ **香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少**

（<u>若题目中同时可计算奈奎斯特和香农定理，则取两者数值最小的</u>）

`编码与调制`

__编码__：数据 $\Rightarrow$ 数字信号					__调制__：数据 $\Rightarrow$ 模拟信号

<img src="计算机网络.assets/截屏2022-08-24 16.18.14.png" alt="截屏2022-08-24 16.18.14" style="zoom:55%;" />

**基带传输**：在数字信道中直接传输<u>数字信号</u>（适用于小范围的传输，如局域网内）

**频带传输**：将代表数据的二进制“1” 和“0”，变换成具有一定频带范围的<u>模拟信号</u>，以适应在模拟信道上传输

​						 （适用于大范围）

**宽带传输**：将模拟信道分成多个子信道，分别传送音频、视频、和数字信号，分别在子信道上同时进行频带传输

​						 （适用于大范围）

* __数字数据编码为数字信号__

    <img src="计算机网络.assets\image-20211026203311471.png" alt="image-20211026203311471" style="zoom: 67%;" />

    * __归零编码（RZ）__

    	<u>高电平代表1，低电平代表0</u>，<u>每个时钟周期的中间均跳变到低电平</u>；==提供了自同步机制==

    * __非归零编码（NRZ）__

    	同RZ编码，但不用归零；==无法同步==
    
    
    * __反向非归零编码（NRZI）__
    
    	<u>用信号的翻转代表0，保持不变代表1</u>；==能传输时钟信号，可同步==；**USB2.0通信编码就是NRZI编码**
    
    * __曼彻斯特编码__
    
    	<u>前一个间隔为高电平后一个间隔为低电平表示码元1；码元0相反</u>
    
    	==既作为时钟信号（可用于同步），又作为数据信号==；==以太网使用的编码方式就是曼彻斯特编码==
    
    	==频带宽度是原始基带宽度的两倍（数据传输速率只有调制速率的1/2、数据率是波特率的1/2）==
    
    * **差分曼彻斯特编码**
    
    	<u>若码元为1，则前半个码元的电平与上一个码元的后半个码元的电平相同；若码元为0，则相反</u>
    
    	==常用于局域网传输==；==可实现自同步，抗干扰性较好==
    
    * __4B/5B编码__
    
    	比特流中插入额外的比特以打破一连串的0或1，就是用5个比特来编码4个比特的数据，再传给接收方
    
    	==编码效率为80%（数据率是波特率的80%）==
    
* **数字数据调制为模拟信号**

    ==ASK（幅移键控）、FSK（频移键控）、PSK（相移键控）、QAM（正交振幅调制）==

    <img src="计算机网络.assets/截屏2022-08-24 16.29.11.png" alt="截屏2022-08-24 16.29.11" style="zoom:60%;" />

* **模拟数据编码为数字信号**

  计算机内部处理的是二进制数据，处理的都是数字音频所以需要将模拟音频通过采样、量化转换成有限个数字表示的离散序列( 即实现音频数字化)；最典型的例子是==对音频信号进行编码的脉码调制(PCM)== ，在计算机应用中能够达到最高保真水平的就是PCM编码，被广泛用于素材保存及音乐欣赏，CD、 DVD以及常见的WAV文件中均有应用；主要包括三步:抽样、量化、编码

  1⃣️ **抽样**，对模拟信号周期性扫描，把时间上连续的信号变成时间上离散的信号；为了使所得的离散信号能无失真地代表被抽样的模拟数据，要使用采样定理进行采样: ==$f_{采样频率}\ge 2f_{信号最高频率}$==

  2⃣️ **量化**，把抽样取得的电平幅值按一 定的分级标度转化为对应的数字值并取整数，就把连续的电平幅值转换为离散的数字量

  3⃣️ **编码**，把量化的结果转换为与之对应的二进制编码

* **模拟数据调制为模拟信号**

  ==频分复用（FDM）==

  为了实现传输的有效性，可能需要较高的频率；这种调制方式还可以使用频分复用技术，充分利用带宽资源；在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式；模拟的声音数据是加载到模拟的载波信号中传输的


`数据交换方式`

* __电路交换__

    在进行数据传输前，两个结点之间必须先建立一条专用（双方独占）的物理通信路径（由通信双方之间的交换设备和链路逐段连接而成），该路径可能经过许多中间结点，在数据传输结束之前，这条线路一直保持

    **阶段**：==$建立连接（呼叫/电路建立）\to 通信（数据传输）\to 释放连接（拆除电路）$==

    **特点**：==独占资源==，==适用于远程批处理信息传输或系统间实时性要求高的大量数据传输的情况==

    **优点**：==传输时延小==；==数据顺序传送，无失序问题==；==适用于模拟信号和数字信号==

    ​				==实时性强==（双方一旦建立物理通路，便可以实时通信，**适用于交互式会话类通信**）

    ​				==全双工通信==（没有冲突，通信双方有不同的信道，不会争用物理信道）

    ​				控制简单（电路的交换设备及控制较简单）

    **缺点**：==建立连接时间长==；==信道使用效率低==（线路独占，即使通信线路空闲，也不能供其他用户使用）

    ​				==灵活性差==（双方连接通路中的任何一点出了故障，必须重新拨号建立新连接，不适应突发性通信）

    ​				==无数据存储能力，难以平滑通信量==；==不提供差错控制功能==（无法发现与纠正传输差错）
    
    ​				电路交换时，数据直达，**不同类型、不同规格、不同速率的终端很难相互进行通信**

* __报文交换__

​		  **数据交换单位**：==报文==					                  **传输方式**：==存储转发==

​		  **优点**： ==无需建立连接==（无建立连接时延，用户可随时发送报文）

​							==动态分配线路==（动态选择报文通过的最佳路径，可以平滑通信量）

​							==提高线路可靠性==（某条传输路径发生故障，可重新选择另一条路径传输）

​							==提高线路利用率==（通信双方在不同的时间一段一段地部分占有这条物理通道，多个报文可共享信道）

​							==提供多目标服务==（一个报文可同时发往多个目的地址）

​							==便于类型、规格和速度不同的计算机之间进行通信==

​							（在存储转发中容易实现代码转换和速率匹配，甚至收发双方可以不同时处于可用状态）

​			**缺点**：==实时性差==

​						 （**不适合传送实时或交互式业务的数据，如语音，视频**；数据进入交换结点后要经历存储转发过程，引起转发时延）

​							==只适用于数字信号==

​							由于报文长度没有限制，而每个中间结点都要完整地接收传来的整个报文，当输出线路不空闲时，还可能要存储几个							完整报文等待转发，**要求网络中每个结点有较大的缓冲区**；为了降低成本，减少结点的缓冲存储器的容量，有时要把							等待转发的报文存在磁盘上，进一步增加了传送时延，**数据经过网络的传输延迟长且不固定**

* __分组交换__

    （把数据分割成小块，然后逐块地发送；==以太网采用分组交换技术==）

    **传输方式**：==存储转发==（==限制所传输的数据单位的长度==）
    
    **分组交换对报文交换对主要改进**：==传输单位更小且有固定的最大长度==
    
    **优点**：==无建立时延==（无需为通信双方预先建立条专用通信线路，用户可随时发送分组）
    
    ​				==线路利用率高==（通信双方在不同的时间一段一段地部分占有这条物理通道，多个分组可共享信道）
    
    ​				==简化了存储管理==
    
    ​			（分组的长度固定，相应的缓冲区大小也固定，交换结点中存储器的管理被简化为对缓冲区的管理，相对比较容易）
    
    ​				==加速传输==（后一个分组存储可以和前一个分组转发并行操作；传输分组比报文所需缓冲区小，减少等待发送时间）
    
    ​				==提高可靠性==（减少出错几率和重发数据量，减少传输时延）
    
    ​				分组短小，**适用于计算机之间突发式数据通信**
    
    **缺点**：尽管分组交换比报文交换的传输时延少，但<u>仍存在存储转发时延</u>，而且其<u>结点交换机必须具有更强的处理能力</u>
    
    ​				==降低了通信效率==（每个分组都要加控制信息，一定程度上增加了处理的时间）
    
    ​				当分组交换采用**数据报**服务时，<u>可能出现失序、丢失或重复分组</u>，分组到达目的结点时，要对分组按编号进行排序等				工作，增加了麻烦；若采用**虚电路**服务，虽无失序问题，但<u>有呼叫建立、数据传输和虚电路释放三个过程</u>
    
    * **数据报方式**
    
      （就是普通分组交换）
    
      **特点**：1⃣️ 数据报方式为网络层==提供无连接服务==（发送方可随时发送分组，网络中的结点可随时接收分组）
    
      ​				（**无连接服务**：不事先为分组的传输确定传输路径，每个分组独立确定传输路径，不同分组传输路径可能不同）
    
      ​				2⃣️ ==同一报文的不同分组到达目的结点时可能发生乱序、重复与丢失==
    
      ​				3⃣️ ==每个分组在传输过程中都必须携带源地址和目的地址，以及分组号==
    
      ​				4⃣️ 分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延；当通过交换结点的通信量较大或网
      ​						络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组
    
      ​				5⃣️ 网络具有冗余路径，当某一交换结点或一段链路出现故障时，可相应地更新转发表，寻找另一条路径转发分						组，==对故障的适应能力强，适用于突发性通信==，不适于长报文、会话式通信
    
      ==在出错率很高的传输系统中，选择数据报方式更合适==
    
    * **虚电路方式**
    
    	一条源主机到目的主机类似于电路的路径，路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表， 每一项记录了一个打开的虚电路的信息
    
    	**流程**：1⃣️ **建立连接**，源主机发送“呼叫请求”分组并收到“呼叫应答”分组后才算建立连接
    
    	​				2⃣️ **数据传输**，每个分组携带==虚电路号，分组号、检验和等控制信息==
    
    	​				2⃣️ **释放连接**，源主机发送“释放请求”分组以拆除虛电路
    
    	**特点**：1⃣️ 虚电路方式为网络层==提供连接服务==（**逻辑连接**）
    
    	​					（**连接服务**：首先为分组的传输确定传输路径，然后沿该路径传输系列分组，系列分组传输路径相同，传输结						束后拆除连接）
    
    	​				2⃣️ 一次通信的所有分组都通过虚电路顺序传送，**分组不需携带源地址、目的地址等信息**，<u>相对数据报方式开销</u>
    
    	​						<u>小</u>，==同一报文的不同分组到达目的结点时不会乱序、重复或丢失==
    
    	​				3⃣️ 分组通过虚电路上的每个节点时，==节点只进行差错检测，不需进行路由选择==（路已经选好了）
    
    	​				4⃣️ ==每个节点可能与多个节点之间建立多条虚电路==，每条虚电路支持特定的两个端系统之间的数据传输，可以对
    	​						两个数据端点的流量进行控制，==两个端系统之间也可以有多条虚电路为不同的进程服务==
    
    	​				5⃣️ **当网络中的某个结点或某条链路出故障而彻底失效时，则所有经过该结点或该链路的虚电路将遭到破坏**
    
    	​				<img src="计算机网络.assets/截屏2022-08-25 21.51.49.png" alt="截屏2022-08-25 21.51.49" style="zoom: 75%;" />
    	
    	虚电路的连接不只是临时性的，它提供的服务包括==永久性虚电路和交换型虚电路==，其中前者是一种提前定义好的、基本上不需要任何建立时间的端点之间的连接，而后者是端点之间的一种临时性连接，这些连接只持续所需的时间，并且在会话结束时就取消这种连接

`物理层传输介质`

**传输介质**：1⃣️ **导向性传输介质**，电磁波被导向沿着固体媒介（铜线/光纤）传播

​						 2⃣️ **非导向性传输介质**，自由空间，介质可以是空气、真空、海水等

**导向性传输介质**

* **双绞线**

​		 __绞合作用__：==绞合可以减少对相邻导线的电磁干扰==			__特点__：==价格便宜==

​		 __屏蔽双绞线（STP）__：为了进一步==提高抗电磁干扰的能力==（目的），可在双绞线的外面再加上一层，

​														  即用金属丝编织成的屏蔽层；无屏蔽层的双绞线称为__非屏蔽双绞线（UTP）__

​		 距离太远时，对于**模拟传输**，可以用<u>放大器放大衰减的信号</u>；对于**数字传输**，<u>用中继器将失真的信号整形</u>

* **同轴电缆**

	由于外导体屏蔽层的作用，==同轴电缆具有良好的抗干扰特性==；**被用于传输较高速率的数据，传输距离更远；价格比双绞线贵**

	**50欧姆同轴电缆**：用于传送<u>基带数字信号</u>，又称为<u>基带同轴电缆</u>，在局域网中得到广泛应用

	**75欧姆同轴电缆**：用于传送<u>宽带信号</u>，又称为<u>宽带同轴电缆</u>，主要用于有线电视系统

	**利用一根同轴电缆互连主机构成以太网，则主机间的通信方式为半双工**

	**同轴电缆比双绞线的传输速率更高，得益于同轴电缆具有更高的屏蔽性，同时有更好的抗噪声性**

* **光纤**

​		 __多模光纤__：利用光的全反射特性，可以将从不同角度入射的多条光线在一根光纤中传输，这种光纤称为<u>多模光纤</u>

​		 ==多模光纤光源是发光二极管==；==易失真，适合于近距离传输==，

​		 __单模光纤__：光纤的直径减小到只有一个光的波长时，光纤就像一根波导那样，使光线一直向前传播，而不会产生多次反射

​		 ==单模光纤的光源为定向性很好的半导体激光器==；==衰耗小，适合远距离传输==

​		 __特点__：1⃣️ 传输损耗小，中继距离长     2⃣️ ==抗雷电和电磁干扰性能好==     3⃣️ 不易被窃听或截取数据      4⃣️ 体积小，重量轻

​		 **不受电磁干扰和噪声影响的传输介质是光纤**

**非导向性传输介质**

* **无线电波**

​		 信号向<u>所有方向</u>传播；==具有较强的穿透能力==

* **微波、红外线和激光**

​		 信号<u>固定方向</u>传播，沿直线传播

​		 __卫星通信__：利用地球同步卫星作为中继来转发微波信号

​						 		 **优点**：==通信容量大；距离远、覆盖广；广播通信和多址通信==

​						 		 **缺点**：==保密性差；端到端传播时延长；受气候影响大；误码率高；成本高==

`物理层设备`

* **中继器**

​		  __原理__：==信号再生和还原==（而非简单地将衰减的信号放大）

​		 ==中继器两端的网络部分是网段，而不是子网==； ==中继器两端的网段一定要是同一个协议，且两个网段速率要相同==

​		 （<u>如果某个网络设备具有存储转发的功能，那么可以认为它能连接两个不同的协议</u>，即==中继器没有存储转发的功能==）

​		 ==端口仅作用于信号的电气部分，而不管是否有错误或不适于网段的数据==；==使用中继器连接的几个网段仍然是一个局域网==

​		 **两端可连相同媒体，也可连不同媒体**（光纤、同轴电缆等）

​		 ==在采用粗同轴电缆的10BASE5以太网规范中，互相串联的中继器的个数不能超过4个，且用4个中继器串联的5段通信介质中==

​		 ==只有3段可以挂接计算机==

|          |        中继器        |      放大器      |
| :------: | :------------------: | :--------------: |
| 信号种类 |     ==数字信号==     |   ==模拟信号==   |
|   原理   | 将衰减的信号整形再生 | 将衰减的信号放大 |

​		 **放大器会同时放大噪声，引起失真；中继器会减少失真**

​		 <u>转发器又被称为中继器或放大器，作用是放大信号</u>

​		 **网段**：指一个计算机网络中使用同一物理层设备能够直接通讯的那一部分；如从192.168.0.1到192.168.255.255之间就是

​						一个网段；<u>同一网段指的是IP地址和子网掩码相与得到相同的网络地址</u>

​		 **两个网段在物理层进行互联时要求数据传输率要相同, 但数据链路层协议可以不相同**

​		 （==两个网段在A层互联，A层及以下层协议相同，A层以上协议可以不同==）

* **集线器**

​		  对信号进行==再生放大转发，对衰减的信号进行放大==，接着==转发到其他所有（除输入端口外）==处于工作状态的端口上，

​		  以增加信号传输的距离

​		 ==实质是一个多端口的中继器==；==只能工作在半双工状态下==；==集线器不能分割冲突域，所有集线器的端口都属于同一个冲突域==

​		  **集线器连接的网络在物理拓扑结构上属于星形，在逻辑拓扑结构上是总线型**

​		  **中继器和集线器都可以对信号进行放大和整形**

### 第3章 数据链路层

**结点**：主机、路由器

**链路**：网络中两个结点之间的<u>物理通道</u>，链路的传输介质主要有双绞线、光纤和微波，分为有线链路、无线链路

**数据链路**：网络中两个结点之间的<u>逻辑通道</u>，把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路

`组帧`

（在一段数据的前后部分添加首部和尾部，这样就构成了一个帧；==目前较普遍使用的帧同步法是比特填充和违规编码法==）

* **字符计数法**

	（帧首部使用第一个字节（8bit）来标明帧内字符数）

	**缺点**：如果计数字段出错，即失去了帧边界划分的依据，那么接收方就无法判断所传输帧的结束位和下一帧的开始位，收发双方将失去同步

	<img src="计算机网络.assets/截屏2022-09-24 17.27.44.png" alt="截屏2022-09-24 17.27.44" style="zoom:28%;" />

* **字符填充的首尾定界符法**

	（发送方在每个EOT或SOH字符前再插入一个ESC字符，接收方收到数据后再删除这个插入的ESC字符）

	<img src="计算机网络.assets/截屏2022-09-24 17.31.33.png" alt="截屏2022-09-24 17.31.33" style="zoom:28%;" />

* **零比特填充的首尾标志法**

	用01111110标志一帧的开始和结束；为了不使信息位中出现的比特流01111110被误判为帧的首尾标志，发送方的数据链路层在信息位中遇到5个连续的1时，将自动在其后插入一个0，而接收方每收到5个连续的1时，自动删除后面的0

	==容易由硬件实现，性能优于字符填充法==

	<img src="计算机网络.assets/截屏2022-09-24 17.40.23.png" alt="截屏2022-09-24 17.40.23" style="zoom:33%;" />

* **违规编码法**

	在物理层进行比特编码时，通常采用违规编码法；曼彻斯特编码将数据比特1编码成“高-低”电平对，将数据比特0编码成“低-高”电平对，而<u>“高-高”电平对和“低-低”电平对在数据比特中是违规的，可以借用这些违规编码序列来定界帧的起始和终止</u>

	<img src="计算机网络.assets/截屏2022-09-24 17.41.54.png" alt="截屏2022-09-24 17.41.54" style="zoom:25%;" />

`差错控制`

**差错产生的原因**：1⃣️ 由于线路本身电气特性所产生的<u>随机噪声</u>(热噪声)，是信道固有的，随机存在的

​												通过提高信噪比来减少或避免干扰

​										2⃣️ 外界特定的短暂原因所造成的<u>冲击噪声</u>，是==产生差错的主要原因==（通常利用<u>编码技术</u>来解决）

**检错编码**

* **奇偶校验码**

	由n-1位信息元和I位校验元组成，如果是**奇校验码**，那么在附加一个校验元后，码长为n的码字中<u>“1”的个数为奇数</u>；

	如果是**偶校验码**，那么在附加一个校验元以后，码长为n的码字中<u>“1” 的个数为偶数</u>

	它==只能检测奇数个比特错误==，但并不知道哪些位错了，也不能发现偶数位的出错情况

* **CRC循环冗余码**

	要发送的数据是1101 0110 11，采用CRC校验，生成多项式是10011，那么最终发送的数据应该是？

	**最终发送的数据**：==要发送的数据 + 冗余码/帧检验序列FCS==

	**冗余码的计算**：1⃣️ 加0，假设生成多项式G(x)的阶为r，则<u>加r个0</u>（==多项式N位，阶为N-1==）		

	​									2⃣️ 模2，除法数据加0后除以多项式，余数为冗余码

	<img src="计算机网络.assets/截屏2022-09-24 18.06.55.png" alt="截屏2022-09-24 18.06.55" style="zoom:30%;" />

	**接收端捡错过程**：把收到的每一个帧都除以同样的除数，然后检查得到的余数R；<u>若余数为0</u>，判定这个帧没有差错

	<u>若余数为不为0</u>，判定这个帧有差错，丢弃

	FCS的生成以及接收端CRC检验都是由==硬件实现==，处理很迅速，因此不会延误数据的传输

**纠错编码**

* **海明码**

	**码距**：也称海明距离，两个合法编码(码字)的对应比特取值不同的比特数；一个有效编码集中,<u>任意两个</u>合法编码的<u>海明距离的最小值</u>称为该编码集的海明距离；==检错d比特，需要码距为d+1；纠错d比特，需要码距为2d+1==

	1⃣️ **确定校验码位数**，==$2^r\ge m+r+1$==（数据位数m，冗余码/校验码位数r）
	
	2⃣️ **确定校验码和数据的位置**，校验码放在序号为$2^0\sim 2^{r-1}$的位置，数据按序填上
	
	<img src="计算机网络.assets/截屏2022-09-27 08.47.05.png" alt="截屏2022-09-27 08.47.05" style="zoom:30%;" />
	
	3⃣️ **求出校验码的值**
	
	<img src="计算机网络.assets/截屏2022-09-27 08.51.48.png" alt="截屏2022-09-27 08.51.48" style="zoom:33%;" />
	
	4⃣️ **检错**
	
	<img src="计算机网络.assets/截屏2022-09-27 08.58.13.png" alt="截屏2022-09-27 08.58.13" style="zoom:33%;" />
	
	5⃣️ **纠错**
	
	<img src="计算机网络.assets/截屏2022-09-27 08.58.54.png" alt="截屏2022-09-27 08.58.54" style="zoom:33%;" />

`流量控制`

* **停止-等待协议**

	__出错情况__：

	1⃣️ **数据帧丢失或到达目的站的帧遭到破坏**

	（接收方会将损坏的帧丢弃）在一个帧发送后，发送方等待确认，如果在计时器计满时仍未收到确认，则再次发送相同的帧

	<img src="计算机网络.assets/截屏2022-09-27 09.16.12.png" alt="截屏2022-09-27 09.16.12" style="zoom:33%;" />

	2⃣️ **确认帧丢失或遭到破坏**

	发送方会重传已被接收的数据帧，接收方收到同样的数据帧会丢弃该帧，并重传一个该帧对应的确认帧

	<img src="计算机网络.assets/截屏2022-09-27 09.20.01.png" alt="截屏2022-09-27 09.20.01" style="zoom:33%;" />

	3⃣️ __确认帧迟到__

	<img src="计算机网络.assets/截屏2022-09-27 09.21.50.png" alt="截屏2022-09-27 09.21.50" style="zoom:33%;" />

	**缺点**：==信道利用率低==

* **后退N帧协议**（GBN）

	接收方<u>只允许按顺序接收帧</u>，虽然又收到了其他帧，但必须将这些帧==丢弃==，且应重复发送已发送的最后一个确认帧

	==可以在连续收到好几个正确的数据帧后，才对最后一个数据帧发确认信息==（累积确认）

	__发送窗口尺寸__：==$1\leqslant W_T \leqslant 2^n-1 $==（采用n个比特对帧编号）

<img src="计算机网络.assets\image-20211108134413506.png" alt="image-20211108134413506" style="zoom:50%;" />

<img src="计算机网络.assets\image-20211108141845635.png" alt="image-20211108141845635" style="zoom:50%;" />

* **选择重传协议**（SR）

	<img src="计算机网络.assets/截屏2022-09-27 09.45.39.png" alt="截屏2022-09-27 09.45.39" style="zoom:33%;" />

	__发送方__：1⃣️ 如果收到ACK且帧序号在窗口内，则将该帧标记为已接收；如果该帧是窗口的下界，则将窗口向前移动到具有

	​							最小序号的未确认帧处；如果窗口移动了且窗口内有未发送的帧，则发送这些帧

	​					2⃣️ 每个帧都有自己的定时器，一个超时事件发生后只重传一个帧

	__接收方__：将确认一个正确接受的帧而不管其是否按序，失序的帧将被缓存，并返回给发送方一个该帧的确认帧，直到所有

	​					帧被收到为止，才将这批帧交付上层，向前移动滑动窗口

	<img src="计算机网络.assets/截屏2022-09-27 09.53.37.png" alt="截屏2022-09-27 09.53.37" style="zoom:33%;" />

	**发送/接收窗口长度**：==$W_{Tmax}=W_{Rmax}=2^{(n-1)}$==（采用n个比特对帧编号）

**其他**

__停止-等待协议__：==发送窗口大小 = 1，接收窗口大小 = 1==				__后退N帧协议__：==发送窗口大小 > 1，接收窗口大小 = 1==

__选择重传协议__：==发送窗口大小 > 1，接收窗口大小 > 1==

==$信道利用率=(L/C)/T=帧的传输时延/(帧的传输时延+确认帧的传输时延+2\times传播时延)$==

（T:发送周期，L：T内发送L比特数据，C：发送方的数据传输速率）

==$信道吞吐率=信道利用率\times 发送方的发送速率$==

`介质访问控制`

（采取一定的措施，使得两对节点之间的通信不会发生互相干扰的情况）

* **静态划分信道**

	* **频分多路复用**（FDM）

		用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带；频分复用的所有用户在同样的时间占用不同的带宽(频率带宽)资源

	* **时分多路复用**（TDM）

		将时间划分为一段段等长的时分复用帧(TDM帧)，每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道

		<img src="计算机网络.assets/截屏2022-09-27 16.36.09.png" alt="截屏2022-09-27 16.36.09" style="zoom:30%;" />

		**统计时分复用**（STDM）

		<u>每一个STDM帧中的时隙数小于连接在集中器上的用户数</u>；各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中，一个STDM帧满了就发出；

		==STDM帧不是固定分配时隙，而是按需动态分配时隙==（一个设备可能占用所有间隙）

		<img src="计算机网络.assets/截屏2022-09-27 16.39.46.png" alt="截屏2022-09-27 16.39.46" style="zoom:28%;" />

	* **波分多路复用**（WDM）

		波分多路复用就是光的频分多路复用，在一根光纤中传输多种不同波长(频率)的光信号，由于波长(频率)不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来

	* **码分多路复用**（CDM）

* **动态分配信道**

	（信道并非在用户通信时固定分配给用户）

	* **轮询访问介质访问控制**

	  * **轮询协议**

	  	（主结点轮流“邀请”从属结点发送数据）

	  	**缺点**：<u>轮询开销、等待延迟、单点故障</u>

	  * **令牌传递协议**

	  	**令牌**：一个特殊格式的MAC控制帧，不含任何信息；控制信道的使用，确保同一时刻只有一个结点独占信道

	  	每个结点都可以在一定的时间内（令牌持有时间）获得发送数据的权利，并不是无限制地持有令牌

	  	**缺点**：令牌开销、等待延迟、单点故障

	  	==应用于令牌环网（物理星型拓扑，逻辑环形拓扑）==；==令牌环网无碰撞==；==常用于负载较重、通信量较大的网络==

	* **随机访问介质访问控制**

		（所有用户可随机发送信息，发送信息时占全部带宽）

		* **ALOHA协议**

			（不监听信道，不按时间槽发送，随机重发，想发就发）

			如果发生冲突，接收方在就会检测出差错，然后不予确认；发送方在一定时间内收不到就判断发生冲突，超时后等一随机时间再重传

			**时隙ALOHA协议**

			把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送

			==纯ALOHA比时隙ALOHA吞吐量更低， 效率更低==

		* **载波监听多路访问协议**（CSMA协议）

			（每一个站在==发送数据之前==要检测一下总线上是否有其他计算机在发送数据）

			1⃣️ **1-坚持CSMA**（坚持指对于监听<u>信道忙</u>之后的坚持）

			​       若一个主机要发送消息，先监听信道；<u>空闲则直接传输，不等待</u>；==忙则一直监听，直到空闲马上传输==

			​       如果有冲突(一段时间内未收到肯定回复)，则<u>等待一个随机长的时间再监听</u>，重复上述过程

			​       **优点**：只要媒体空闲，站点就马上发送，避免了媒体利用率的损失

			​       **缺点**：假如有两个或两个以上的站点有数据要发送，冲突就不可避免（监听结束后所有主机都一起发送）

			2⃣️ **非坚持CSMA**（非坚持指对于监听<u>信道忙</u>之后就不继续监听）

			​       若一个主机要发送消息，先监听信道；<u>空闲则直接传输，不等待</u>；==忙则等待一个随机的时间之后再进行监听==

			​       **优点**：采用随机的重发延迟时间可以减少冲突发生的可能性

			​       **缺点**：可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低
	
			3⃣️ **p-坚持CSMA**（p-坚持指对于监听<u>信道空闲</u>的处理）
	
			​       如果一个主机要发送消息，先监听信道；<u>空闲则以p概率直接传输，不等待</u>；<u>概率1-p等到下一个时间槽再传输</u>
	
			​       ==忙则一直监听直到信道空闲再以p概率发送==；若冲突则等到下一个时间槽开始再监听并重复上述过程
	
			​       **优点**：既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间的这种方案
	
		* **载波监听多点接入/碰撞检测协议**（CSMA/CD协议）
	
			（每一个站在==发送数据之前以及发送数据时（边发送边监听）==都要检测总线上是否有其他计算机在发送数据）
	
			==应用于总线型网络、半双工网络==
			
			**确定碰撞的最长时间**：==两倍的总线端到端的传播时延(2τ)==
			
			（只要经过2τ时间还没有检测到碰撞，就能肯定这次发送不会发生碰撞）
			
			==$最小帧长=总线传播时延(2τ)\times 数据传输速率\times 2$==
			
			**确定碰撞后的重传时机**：（截断二进制指数规避算法）
			
			1⃣️ 确定基本退避(推迟)时间为争用期2τ
			
			2⃣️ 定义参数k，它等于重传次数，但k不超过10，即k=min[重传次数， 10]；当重传次数不超过10时，k等于
			重传次数；当重传次数大于10时，k就不再增大而一直等于10
			
			3⃣️ 从离散的整数集合$[0, 1,..., 2^k-1]$中随机取出一个数r，重传所需要退避的时间就是r倍的基本退避时间，即
			2rτ；重传推迟时间为$[0、2τ ... 2rτ]$，在这时间中随机选一个
			
			4⃣️ 当重传达16次仍不能成功时，说明网络太拥挤，认为此帧永远无法正确发出，抛弃此帧并向高层报告出错
			
			==用于总线式以太网==；==通过电缆中电压的变化实现碰撞检测==
			
		* **载波监听多点接入/碰撞避免**（CSMA/CA）
		
		  1⃣️ 发送数据前，先检测信道是否空闲
		
		  ​      空闲则发出<u>RTS</u> (request to send)，RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息
		
		  ​      信道忙则等待
		
		  2⃣️ 接收端收到RTS后，将响应<u>CTS</u> (clear to send)
		
		  ​      发送端收到CTS后，开始发送数据帧（同时==预约信道==：发送方告知其他站点自己要传多久数据）
		
		  ​      接收端收到数据帧后，将用CRC来检验数据是否正确，正确则==响应ACK帧==
		
		  3⃣️ 发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止
		
		  ​    （采用二进制指数退避算法来确定随机的推迟时间）
		
		  ==用于无线局域网==；==通过能量检测、载波检测和能量载波混合检测实现检测信道是否空闲==

`局域网`

**拓扑结构**：==星型、环型、总线型、树型==

**介质访问控制方法**：1⃣️ **CSMA/CD**，用于<u>总线型</u>局域网	2⃣️ **令牌总线**，用于<u>总线型</u>局域网	3⃣️ **令牌环**，用于<u>环形</u>局域网

**IEEE 802标准**：1⃣️ **IEEE 802.3**，以太网介质访问控制协议(CSMA/CD) 及物理层技术规范

​								  2⃣️ **IEEE 802.5**，令牌环网的介质访问控制协议及物理层技术规范

​								  3⃣️ **IEEE 802.8**，光纤技术咨询组，提供有关光纤联网的技术咨询

​								  4⃣️ **IEEE 802.11**，无线局城网的介质访问控制协议及物理层技术规范

**MAC子层和LLC子层**

IEEE 802标准所描述的局域网参考模型只对应OSI参考模型的数据链路层与物理层，它将数据链路层划分为逻辑链路层LLC子层和介质访问控制MAC子层

**LLC子层**：负责识别网络层协议，然后对它们进行封装，LLC报头告诉数据链路层一旦帧被接收到时，应当对数据包做何处理，

​						为网络层提供服务（无确认无连接、面向连接、带确认无连接、高速传送）

**MAC子层**：包括数据帧的封装/卸装，帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等；

​						MAC子层的存在屏蔽了不同物理链路种类的差异性

<img src="计算机网络.assets/截屏2022-09-30 09.01.29.png" alt="截屏2022-09-30 09.01.29" style="zoom:45%;" />

`以太网（Ethernet）`

==使用CSMA/CD==；==以太网提供无连接、不可靠的服务==（不对发送方的数据帧编号，接收方不向发送方进行确认）

**拓扑结构**：==逻辑上总线型，物理上星型==

**10BASE-T**：是传送<u>基带信号</u>的双绞线以太网，T表示采用双绞线，现10BASE-T采用的是无屏蔽双绞线(UTP)，==传输速率是10Mb/s==

​						  <u>物理上采用星型拓扑，逻辑上总线型</u>；==采用曼彻斯特编码==；==采用CSMA/CD介质访问控制==

**MAC地址**：又称<u>物理地址</u>；==6B==

**MAC帧**：

<img src="计算机网络.assets/截屏2022-09-30 09.16.31.png" alt="截屏2022-09-30 09.16.31" style="zoom:50%;" />

**高速以太网**

（速率 ≥ 100Mb/s的以太网）

* **100BASE-T以太网**

	在双绞线上传送==100Mb/s==<u>基带信号</u>的==星型==拓扑以太网，仍使用IEEE8023的<u>CSMA/CD</u>协议

	支持==全双工和半双工==，可在全双工方式下工作而无冲突

* **吉比特以太网**

	在光纤或双绞线上传送==1Gb/s==信号；支持==全双工和半双工==，可在全双工方式下工作而无冲突

* **10吉比特**

	10吉比特以太网在光纤上传送==10Gb/s==信号；==只支持全双工==，无争用问题

`无线局域网`

<img src="计算机网络.assets/截屏2022-09-30 09.25.27.png" alt="截屏2022-09-30 09.25.27" style="zoom:40%;" />

<img src="计算机网络.assets/截屏2022-09-30 09.26.26.png" alt="截屏2022-09-30 09.26.26" style="zoom:40%;" />

`虚拟局域网（VLAN）`

一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组有某些共同的需求；每个VLAN是一个单独的广播域/不同的子网

### 第4章 网络层

**网络层的目的**：在<u>任意结点</u>间进行数据报传输				**路由器连接的异构网络**：<u>指数据链路层和物理层均不同</u>

**网络拥塞的根据**：<u>随着通信子网负载的增加，吞吐量反而降低</u>

**路由器互联的多个局域网的结构中，要求每个局域网**：<u>物理层、数据链路层、网络层协议可以不同，而网络层以上的高层协议必须相同</u>

**路由选择交付方式**：当发送站与目的站在同一网段内时（要求发送方和接收方具有相同的子网地址）使用<u>直接交付</u>，反之使用<u>间接交付</u>；<u>间接交付的最后一个路由器与目的主机使用直接交付</u>（即间接交付中，包含直接交付）

<img src="计算机网络.assets/截屏2022-09-23 08.44.13.png" alt="截屏2022-09-23 08.44.13" style="zoom:33%;" />

`SDN`

**数据平面**

对于数据处理过程中各种具体处理转发的过程（对应数据报的转发）；==时间短，通常硬件解决==

**功能**：根据转发表进行转发，==是路由器的本地动作==；<u>路由器转发分组的根据是报文IP地址</u>

<img src="计算机网络.assets/截屏2022-09-05 17.02.14.png" alt="截屏2022-09-05 17.02.14" style="zoom:50%;" />

**控制平面**

用于控制和管理网络协议的运行（对应数据报的路由选择）；==时间长，通常软件解决==

* **传统方法/每路由器法**

	路由选择算法运行在每台路由器中，并且在每台路由器中都包含转发和路由选择两种功能；在一台路由器中的路由选择算法与其他路由器中的路由选择算法通信（通过交换路由选择报文），计算出路由表和转发表

	==路由选择处理器执行控制平面功能==（在传统的路由器中，它执行路由选择协议，维护路由选择表与关联链路状态信息，并为该路由器计算转发表）

* **SDN方法**（软件定义网络）

	控制平面从路由器物理上分离，路由器仅实现转发，远程控制器计算和分发转发表以供每台路由器所使用；路曲器通过交换包含转发表和其他路由选择信息的报文与远程控制器通信，因为计算转发并与路由器交互的控制器是用软件实现的，所以网络是
	"软件定义的"

	==路由选择处理器负责与远程控制器通信==，目的是接收远程控制器计算的转发表项
	
	**SDN特点**：1⃣️ 控制与转发功能分离 	2⃣️ 控制层面集中化	3⃣️ 接口开放可编程

<img src="计算机网络.assets/截屏2022-09-05 17.08.50.png" alt="截屏2022-09-05 17.08.50" style="zoom:70%;" />

**SDN控制器**：维护准确的网络状态信息(远程链路、交换机和主机的状态) ；为运行在控制平面中的网络控制应用程序提供这些信息						 （逻辑集中，在多台服务器上实现）

**网络控制应用程序**：根据SDN控制器提供的方法，这些应用程序通过这些方法能够监视、编程和控制下面的网络设备

**SDN控制器的三个层次**：

1️⃣ **对于网络控制应用程序的接口**

​		SDN控制器通过北向接口与网络控制应用程序交互；该API允许网络控制应用程序在状态管理层之间读写网络状态

2️⃣ **网络范围状态管理层**

​		由SDN控制平面作出的最终控制决定，将要求控制器具有有关网络的主机、链”路等最新状态信息

3️⃣ **通信层**

​		SDN控制器与受控网络设备之间的通信（OpenFlow协议），包含南向接口

<img src="计算机网络.assets/截屏2022-09-05 17.20.32.png" alt="截屏2022-09-05 17.20.32" style="zoom:80%;" />

`路由算法与路由协议`

**路由算法分类**

<u>静态、动态路由算法都需要使用路由表</u>

* **静态路由算法**（非自适应路由算法）

  （管理员手工配置路由信息；==需要维护整个网络的拓扑结构信息==；<u>用户可以随时配置路由表</u>）

  **优点**：<u>实现简单，开销小；在负荷稳定、拓扑变化不大的网络中运行效果很好</u>；

  ​				==广泛用于高度安全性的军事网络和较小的商业网络==

  **缺点**：==路由更新慢，不适用大型网络==

* **动态路由算法**（自适应路由算法）

	（路由器间彼此交换信息，按照路由算法优化出路由表项）

	**优点**：==路由更新快==；==及时响应链路费用或网络拓扑变化；适用大型网络==

	**缺点**：==算法复杂，增加网络负担==

	* **全局性**

		例子：链路状态路由算法（OSPF）

		所有路由器掌握<u>完整</u>的网络拓扑和链路费用信息

	* **分散性**

		例子：距离向量路由算法（RIP）

		路由器只掌握<u>物理相连</u>的邻居及链路费用

**分层次的路由选择协议**

**背景**：1️⃣ 因特网规模很大  2️⃣ 许多单位不想让外界知道自己的路由选择协议，但还想连入因特网

**自治系统AS**：在单一的技术管理下的一组路由器，而这些路由器使用一种AS内部的路由选择协议和共同的度量以确定分组

​							  在该AS内的路由，同时还使用一种AS之间的路由协议以确定在AS之间的路由；一个AS内的所有网络都属于一

​							  个行政单位来管辖，一个自治系统的所有路由器在本自治系统内都必须连通

**路由选择协议**：

* **内部网关协议**（IGP）

	（一个AS内使用的）				例子：RIP、 OSPF

* **外部网关协议**（EGP）

	（AS之间使用的）                 例子：BGP

	<img src="计算机网络.assets/截屏2022-09-05 17.51.05.png" alt="截屏2022-09-05 17.51.05" style="zoom:50%;" />

`IP数据报`

<img src="计算机网络.assets/截屏2022-09-08 17.41.28.png" alt="截屏2022-09-08 17.41.28" style="zoom:30%;" />

**版本**： IPv4 / IPv6			**首部长度**：==单位是4B==， 最小为5（即20B）			**区分服务**：指示期望获得哪种类型的服务

**总长度**：首部+数据，==单位是1B==（即<u>IP分组规定的最大长度为65535B</u>）		

**生存时间（TTL）** ：IP分组的保质期（经过一个路由器-1，变成0则丢弃）	**标识**：==同一数据报的分片使用同一标识==			

**协议**：==数据部分的协议==（见下表）		**首部检验和**：==只检验首部==			**源IP地址和目的IP地址**：32位

**可选字段**：0~40B，用来支持排错、测量以及安全等措施		**填充**：全0，把首部补成4B的整数倍

**标志**：只有2位有意义（X _ _）

​				1⃣️ **中间位DF**（Don't Fragment） ：==DF=1，禁止分片；DF=0，允许分片==

​						<u>如果分组长度超过MTU,那么当DF=1时，丢弃该分组，并且要用ICMP差错报文向源主机报告</u>

​				2⃣️ **最低位MF**（More Fragment）：==MF=1，后面还有分片；MF=0，代表最后一片或没分片==

**片偏移**：指出较长分组分片后，某片在原分组中的相对位置；==以8B为单位====除了最后一个分片，每个分片长度一定是8B的整数==倍

<u>分片后的数据报在目的主机进行重组</u>（而不是经过的路由器）

| 协议名 | ICMP | IGMP |  TCP  | EGP  | IGP  |  UDP   | IPv6 | ESP  | OSPF |
| :----: | :--: | :--: | :---: | :--: | :--: | :----: | :--: | :--: | :--: |
| 字段值 |  1   |  2   | ==6== |  8   |  9   | ==17== |  41  |  50  |  89  |

**最大传送单元**（MTU）：链路层数据帧可封装数据的上限；==以太网的MTU是1500B==

`IP地址`

（全世界唯一的==32位/4字节==标识符，标识路由器主机的接口）

<img src="计算机网络.assets/截屏2022-09-08 18.07.11.png" alt="截屏2022-09-08 18.07.11" style="zoom:28%;" />

| 网络类别 |     最大可用网络数      | 第一个可用的网络号 | 最后一个可用的网络号 | 每个网络中的最大主机数 |
| :------: | :---------------------: | :----------------: | :------------------: | :--------------------: |
|    A     |         $2^7-2$         |         1          |         126          |       $2^{24}-2$       |
|          |   扣去网络号全0和全1    |                    |                      |   扣去主机号全0和全1   |
|    B     |       $2^{14}-1$        |       128.1        |       191.255        |       $2^{16}-2$       |
|          | 扣去网络号全0（128.0❌） |                    |                      |   扣去主机号全0和全1   |
|    C     |       $2^{21}-1$        |      192.0.1       |     223.255.255      |        $2^8-2$         |
|          |      扣去网络号全0      |                    |                      |   扣去主机号全0和全1   |

<img src="计算机网络.assets/截屏2022-09-08 18.17.50.png" alt="截屏2022-09-08 18.17.50" style="zoom:33%;" />

**私有IP地址**：

路由器对目的地址是私有IP地址的数据报一律不进行转发

<img src="计算机网络.assets/截屏2022-09-08 18.19.49.png" alt="截屏2022-09-08 18.19.49" style="zoom:50%;" />

`网络地址转换NAT`

在专用网连接到因特网的路由器上安装NAT软件，安装了NAT软件的路由器叫NAT路由器，它<u>至少有一个有效的外部全球IP地址</u>

<img src="计算机网络.assets/截屏2022-09-08 21.30.17.png" alt="截屏2022-09-08 21.30.17" style="zoom:33%;" />

`子网划分和子网掩码`

某单位划分子网后，==对外仍表现为一个网络==，即本单位外的网络看不见本单位内子网的划分

子网号能否全0全1要看情况，主机号不能全0全1

<img src="计算机网络.assets/截屏2022-09-08 21.34.42.png" alt="截屏2022-09-08 21.34.42" style="zoom:33%;" />

<img src="计算机网络.assets/截屏2022-09-08 21.46.20.png" alt="截屏2022-09-08 21.46.20" style="zoom:33%;" />

**常见IP转换**：

|  二进制   | 十进制 |  二进制   | 十进制 |
| :-------: | :----: | :-------: | :----: |
| 1000 0000 |  128   | 1100 0000 |  192   |
| 1110 0000 |  224   | 1111 0000 |  240   |
| 1111 1000 |  248   | 11111100  |  252   |
| 1111 1110 |  254   | 11111111  |  255   |

`无分类编址CIDR`

（128.14.32.0/20，20表示网络前缀的位数）

<img src="计算机网络.assets/截屏2022-09-09 16.20.33.png" alt="截屏2022-09-09 16.20.33" style="zoom:30%;" />

<img src="计算机网络.assets/截屏2022-09-09 16.18.49.png" alt="截屏2022-09-09 16.18.49" style="zoom:33%;" />

**构成超网**（路由聚合）

（将多个子网聚合成一个较大的子网）

==所有网络地址（二进制）取交集==（如$206.1.0.0/17与206.1.128.0/17\Rightarrow 206.1.0.0/16$）

**最长前缀匹配**

使用CIDR时，查找路由表可能得到几个匹配结果( 跟网络掩码按位相与)，应选择具有最长网络前缀的路由；前缀越长，地址块越小，路由越具体

`ARP协议`

（完成主机或路由器IP地址到MAC地址的映射）

<u>当数据报到达目的网络后，要传送到目的主机，需要知道IP地址对应的MAC地址</u>

**过程**：检查ARP高速缓存，有对应表项则写入MAC帧，没有则用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装并广播ARP请求分组，

​				同一局域网中所有主机都能收到该请求；目的主机收到请求后就会向源主机单播一个ARP响应分组，源主机收到后将此

​				映射写入ARP缓存（10-20min更新一次）

**4种典型情况**：

1⃣️ 主机A发给本网络上的主机B：用ARP找到主机B的硬件地址

2⃣️ 主机A发给另一网络上的主机B：用ARP找到本网络 上一个路由器(网关)的硬件地址

3⃣️ 路由器发给本网络的主机A：用ARP找到主机A的硬件地址

4⃣️ 路由器发给另一网络的主机B：用ARP找到本网络上的一个路由器的硬件地址

`DHCP协议`

（DHCP提供即插即用联网的机制，主机可以从服务器动态获取IP地址、子网掩码、默认网关、DNS服务器名称与IP地址，允许地址重用，支持移动用户加入网络，支持在用地址续租）

==应用层协议==；==C/S方式==；客户端和服务端通过==广播==方式进行交互；==基于UDP==

**过程**：1⃣️ **主机广播DHCP发现报文**（试图找到网络中的服务器）

​				2⃣️ **DHCP服务器广播DHCP提供报文**（服务器拟分配给主机一个IP地址及相关配置）

​				3⃣️ **主机广播DHCP请求报文**（主机向服务器请求提供IP地址）

​				4⃣️ **DHCP服务器广播DHCP确认报文** （正式将IP地址分配给主机）

`网际控制报文协议`（ICMP）

==网络层协议==；使用==IP数据报==传输数据

<img src="计算机网络.assets/截屏2022-09-15 17.19.01.png" alt="截屏2022-09-15 17.19.01" style="zoom:45%;" />

* **ICMP差错报告报文**

	* **终点不可达**（无法交付）

		当路由器或主机不能交付数据报时就向源点发送终点不可达报文

	* **源点抑制** （拥塞丢数据）

		当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢

	* **时间超过**（TTL=0）

		1⃣️ 当路由器收到生存时间TTL=0的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文；2⃣️ 当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送时间超过报文

	* **参数问题**（首部字段有问题）

		当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文

	* **改变路由**（值得更好的路由）

		路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）

	<img src="计算机网络.assets/截屏2022-09-15 17.30.46.png" alt="截屏2022-09-15 17.30.46" style="zoom:30%;" />

	​																		（箭头表示将数据原封不动的插入对应部分）

	**不应发送ICMP差错报文的情况**：

	1⃣️ 对<u>ICMP差错报告报文</u>不再发送ICMP差错报告报文  2⃣️ 对具有<u>组播地址</u>的数据报都不发送ICMP差错报告报文

	3⃣️ 对<u>第一个分片的数据报片的所有后续数据报片</u>都不发送ICMP差错报告报文

	4⃣️ 对具有<u>特殊地址（如127.0.0.0 或 0.0.0.0）</u>的数据报不发送ICMP差错报告报文

* **ICMP询问报文**

	* **回送请求和回答报文**

		主机或路由器向特定目的主机发出的询问，收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文；

		<u>测试目的站是否可达以及了解其相关状态</u>（ping命令）

	* **时间戳请求和回答报文**

		请某个主机或路由器回答当前的日期和时间；<u>用来进行时钟同步和测量时间</u>

	* **掩码地址请求和回答报文**
	* **路由器询问和通告报文**

**ICMP的应用**

1⃣️ **PING**，测试两个主机之间的连通性，==使用了ICMP回送请求和回答报文==

2⃣️ **Traceroute**，跟踪一个分组从源点到终点的路径，==使用了ICMP时间超过差错报告报文==

`IPv6`

<img src="计算机网络.assets/截屏2022-09-15 17.45.53.png" alt="截屏2022-09-15 17.45.53" style="zoom:33%;" />

<img src="计算机网络.assets/截屏2022-09-15 17.51.35.png" alt="截屏2022-09-15 17.51.35" style="zoom:40%;" />

**版本**：指明了协议版本，总是6		**优先级**：区分数据报的类别和优先级

**流标签**：“流"是互联网络上从特定源点到特定终点的一系列数据报；所有属于同一个流的数据报都具有同样的流标签

**下一个首部**：标识下一个扩展首部或上层协议首部		**跳数限制**：相当于IPv4的TTL

**IPv6和IPv4的区别**

1⃣️ IPv6将地址<u>从32位扩大到128位</u>，更大的地址空间	2⃣️ <u>移除IPv4的校验和字段</u>，以减少每跳的处理时间

3⃣️ 将IPv4的可选字段移出首部，变成了扩展首部，成为灵活的首部格式；路由器不检查扩展首部，提高了路由器的处理效率

4⃣️ <u>支持即插即用(即自动配置)，不需要DHCP协议</u>		5⃣️ ==IPv6首部长度必须是8B的整数倍==，IPv4 首部是4B的整数倍

6⃣️ ==IPv6只能在主机处分片==，IPv4可以在路由器和主机处分片

**地址表示形式**

**一般形式**：$4BF5 : AA12 : 0216 : FEBC : BA5F : 039A : BE9A : 2170$

**压缩形式**：$4BF5 : 0000 : 0000 : 0000 : BA5F : 039A : 000A : 2176\Rightarrow 4BF5 : 0 : 0 : 0 : BA5F : 39A : A : 2176$

**零压缩**：$FF05 : 0 : 0 : 0 : 0 : 0 : 0 : B3\Rightarrow FF05 : : B3$（一连串连续的0可以被一对冒号取代，但只能出现一次）

**IPv6基本地址类型**

1⃣️ **单播**，一对一通信；可做源地址、目的地址		2⃣️ **多播**，一对多通信；可做目的地址

3⃣️ **任播**，一对多中的一个通信（给某分组中的一个）；可做目的地址

**IPv6向IPv4过渡的策略**

* **双栈协议**

	指在一台设备上<u>同时启用IPv4协议栈和IPv6协议栈</u>；这台设备既能和IPv4网络通信，又能和IPv6网络通信；如果这台设备是一个路由器，那么这台路由器的不同接口上，分别配置了IPv4地址和IPv6地址，并很可能分别连接了IPv4网络和IPv6网络；如果这台设备是一个计算机，那么它将同时拥有IPv4地址和IPv6地址，并具备同时处理这两个协议地址的功能

* **隧道技术**

	通过使用互联网络的基础设施在网络之间传递数据的方式；使用隧道传递的数据(或负载)可以是不同协议的数据帧或包；隧道协议将其它协议的数据帧或包<u>重新封装</u>然后通过隧道发送

`RIP协议与距离向量算法`

**RIP协议**

（一种分布式的<u>基于距离向量</u>的==内部网关路由选择协议==；==只适用于小互联网==；==应用层协议，使用UDP传输数据==）

RIP协议要求网络中每一个路由器都维护从它自己到其他每一个目的网络的唯一最佳距离记录（即一组距离）

仅和**相邻路由器交换自己的路由表**；每30秒交换一次路由信息，然后路由器根据新信息更新路由表；若超过180s没收到邻居路由器的通告，则判定邻居没了，并更新自己路由表；路由器刚开始工作时，只知道直接连接的网络的距离(距离为1)，接着每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息；经过若千次更新后，所有路由器最终都会知道到达本自治系统任何一个网络的最短距离和下一跳路由器的地址，即“收敛”

**距离**：通常为“跳数”，即从源端口到目的端口所经过的**路由器个数**，经过一个路由器跳数 +1；特别的，从一路由器到直接连接的网络距离为1；RIP允许一条路由最多只能包含15个路由器，因此==距离为16表示网络不可达==

<u>路由表通常包含目的网络和到达该目的网络路径上的下一个路由器的IP地址</u>

<img src="计算机网络.assets/截屏2022-09-16 17.20.43.png" alt="截屏2022-09-16 17.20.43" style="zoom:33%;" />

​																																（路由表）

<img src="计算机网络.assets/截屏2022-09-16 17.44.43.png" alt="截屏2022-09-16 17.44.43" style="zoom:25%;" />

==一个RIP报文最多可包括25个路由==（如超过，必须再用一个RIP报文传送）

==RIP协议好消息传得快，坏消息传得慢，慢收敛==；==慢收敛是导致发生路由回路的根本原因==

**距离向量算法**

1⃣️ 对地址为X的相邻路由器发来的RIP报文，修改此报文中的所有项目，把下一跳字段中的地址改为X并把所有的距离字段+1

2⃣️ 对修改后的RIP报文中的每一个项目，进行以下步骤：

​		R1路由表中若没有Net3，则把该项目填入R1路由表；R1路由表中若有Net3，则查看下一跳路由器地址：

​		若下一跳是X，则用收到的项目替换源路由表中的项目；若下一跳不是X，原来距离比从X走的距离远则更新，否则不作处理

3⃣️ 若180s还没收到相邻路由器X的更新路由表，则把X记为不可达的路由器，即把距离设置为16

<img src="计算机网络.assets/截屏2022-09-16 17.37.56.png" alt="截屏2022-09-16 17.37.56" style="zoom:33%;" />

`OSPF协议与链路状态算法`

**开放最短路径优先协议**（OSPF）

==内部网关协议==；==适用于大规模的网络==；==网络层协议，直接使用IP数据报传输数据==；使用分布式的链路状态协议；**当链路状态发生变化时**，使用洪泛法向自治系统内**所有路由器发送与本路由器相邻的所有路由器的链路状态**（本路由器和哪些路由器相邻，以及该链路的度量/代价——费用、距离、时延、带宽等），即路由器通过输出端口向所有相邻的路由器发送信息，而每一个相邻路由器又再次将此信息发往其所有的相邻路由器，最终整个区域内所有路由器都得到了这个信息的一个副本，最后，所有路由器都能建立一个链路状态数据库，即全网拓扑图

<img src="计算机网络.assets/截屏2022-09-16 18.11.05.png" alt="截屏2022-09-16 18.11.05" style="zoom:25%;" />

==OSPF不存在坏消息传的慢的问题，它的收敛速度很快==

**OSPF的区域**：

<img src="计算机网络.assets/截屏2022-09-16 18.07.07.png" alt="截屏2022-09-16 18.07.07" style="zoom:33%;" />

**主干路由器**：R3、R7		**区域边界路由器**：R3、R7、R4		**自治系统边界路由器**：R6		**区域内部路由器**：其他所有路由器

**链路状态路由算法**

1⃣️ 每个路由器发现它的邻居结点[HELLO问候分组]，并了解邻居节点的网络地址

2⃣️ 设置到它的每个邻居的成本度量metric

3⃣️ 构造[DD数据库描述分组]，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息

4⃣️ 如果DD分组中的摘要自己都有，则邻站不做处理；如果有没有的或者是更新的，则发送[LSR链路状态请求分组]请求自己没有的和比自己更新的信息

5⃣️ 收到邻站的LSR分组后，发送[LSU链路状态更新分组]进行更新	6⃣️ 更新完毕后，邻站返回[LSAck链路状态确认分组]进行确认

只要一个路由器的链路状态发生变化：

5⃣️ 泛洪发送[LSU链路状态更新分组]进行更新	6⃣️ 更新完毕后，其他站返回一个[LSAck链路状态确认分组]进行确认

7⃣️ 使用Djkstra根据自己的链路状态数据库构造到其他节点间的最短路径

`BGP协议`

==外部网关协议==；==应用层协议==；==使用TCP传输数据==；==采用路径-向量路由算法==

**和谁交换**：与<u>其他AS的邻站BGP发言人</u>交换信息	**交换什么**：交换的网络可达性的信息，即<u>要到达某个网络所要经过的一系列AS</u>

**何时交换**：<u>发生变化时更新有变化的部分</u>

当BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信息中找出到达各AS的较好路由

BGP**支持CIDR**，故BGP的路由表也就应当包括<u>目的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列</u>

在BGP刚刚运行时，BGP 的邻站是<u>交换整个的BGP路由表</u>；但以后只需要在发生变化时更新有变化的部分，这样做对节省网络带宽和减少路由器的处理开销都有好处

**四种报文**：

1⃣️ **OPEN (打开)报文**，用来与相邻的另一个BGP发言人建立关系，并认证发送方

2⃣️ **UPDATE (更新)报文**：通告新路径或撤销原路径

3⃣️ **KEEPALIVE (保活)报文**：在无UPDATE时， 周期性证实邻站的连通性，也作为OPEN的确认

4⃣️ **NOTIFICATION (通知)报文**：报告先前报文的差错；也被用于关闭连接

<img src="计算机网络.assets/截屏2022-09-17 15.28.51.png" alt="截屏2022-09-17 15.28.51" style="zoom:25%;" />

<img src="计算机网络.assets/截屏2022-09-17 15.44.10.png" alt="截屏2022-09-17 15.44.10" style="zoom:35%;" />

`IP组播`

**IP数据报的传输方式**

**单播**：用于发送数据包到单个目的地，且每发送一份单播报文都使用一个单播IP地址作为目的地址；是一种==点对点==传输方式

**广播**：是指发送数据包到同一广播域或子网内的<u>所有设备</u>的一种数据传输方式，是一种==点对多点==传输方式

**组播**（多播）：当网络中的某些用户需要特定数据时，组播数据发送者<u>仅发送一次数据</u>， 借助组播路由协议为组播数据包建立组播分发树，<u>被传递的数据到达距离用户端尽可能近的节点后才开始复制和分发</u>，是一种==点对多点==传输方式

==组播提高了数据传送效率，减少主干网出现拥塞的可能性==；组播组中的主机==可以同一个物理网络，也可以来自不同的物理网络==

**IP组播地址**

（IP组播地址让源设备能够将分组发送给一组设备，属于多播组的设备将被分配一个组播IP地址）

**地址范围**：==224.0.0.0 ~ 239.255.255.255 (D类地址)==，一个D类地址表示一个组播组；==并非所有D类地址都可以作为组播地址==

==只能用作分组的目标地址，源地址总是为单播地址==；==对组播数据报不产生ICMP差错报文==

组播数据报也是==“尽最大努力交付”，不提供可靠交付，应用于UDP==

**硬件组播**

<img src="计算机网络.assets/截屏2022-09-18 17.10.30.png" alt="截屏2022-09-18 17.10.30" style="zoom:50%;" />

同单播地址一样，组播IP地址也需要相应的组播MAC地址在本地网络中实际传送帧；组播MAC地址以十六进制值01-00-5E打头，余下的6个十六进制位是根据IP组播组地址的最后23位转换得到的

<img src="计算机网络.assets/截屏2022-09-18 17.13.13.png" alt="截屏2022-09-18 17.13.13" style="zoom:33%;" />

**网际组管理协议**（IGMP）

（IGMP协议让路由器知道本局域网上是否有主机参加或退出了某个组播组）

==网络层协议==；使用==IP数据报==传输数据

**过程**：1⃣️ 某主机要加入组播组时，该主机向组播组的组播地址发送一个IGMP报文，声明自己要称为该组的成员；本地组播

​					   路由器收到IGMP报文后，要利用组播路由选择协议把这组成员关系发给因特网上的其他组播路由器；

​				2⃣️ 本地组播路由器周期性探询本地局域网上的主机，以便知道这些主机是否还是组播组的成员；只要有一个主机对

​						某个组响应，那么组播路由器就认为这个组是活跃的;如果经过几次探询后没有一个主机响应，组播路由器就认为

​						本网络上的没有此组播组的主机，因此就不再把这组的成员关系发给其他的组播路由器

**组播路由选择协议**

**目的**：找出以源主机为根节点的组播转发树

**路由选择算法**：<u>基于链路状态的路由选择、基于距离-向量的路由选择、协议无关的组播（稀疏/密集）</u>

`移动IP`

移动IP技术是移动结点（计算机/服务器等）以固定的网络IP地址，实现跨越不同网段的漫游功能，并保证了基于网络IP的网络权限在漫游过程中不发生任何改变

**移动结点**：具有永久IP地址的移动设备

**归属代理**（本地代理）：移动结点的永久居所称为归属网络，在归属网络中代表移动节点执行移动管理功能的实体叫做归属代理

**永久地址**（归属地址/主地址）：移动站点在归属网络中的原始地址

**外部代理**（外地代理）：在外部网络中帮助移动节点完成移动管理功能的实体称为外部代理

**转交地址**（辅地址）：可以是外部代理的地址或动态配置的一个地址

**刚进入外部网络**：
1⃣️ 获得外部代理的转交地址（外部代理广播报文）

2⃣️ 移动节点通过外部代理发送注册报文给归属代理( 包含永久地址&转交地址)

3⃣️ 归属代理接收请求，并将移动节点的永久地址和转交地址绑定（以后到达该归属代理的数据报且要发往移动节点的数据报将被封装并以隧道方式发给转交地址），并返回一注册响应报文

4⃣️ 外部代理接收注册响应，并转发给移动节点

**移动到了下一个网络**：

1⃣️ 在新外部代理登记注册一个转交地址		2⃣️ 新外部代理给本地代理发送新的转交地址（覆盖旧的）		3⃣️ 通信

**回到了归属网络**：

1⃣️ 向本地代理注销转交地址		2⃣️ 按原始方式通信

<img src="计算机网络.assets/截屏2022-09-16 22.16.07.png" alt="截屏2022-09-16 22.16.07" style="zoom:25%;" />

`网络层设备`

**路由器**

路由器是一种具有<u>多个输入端口和多个输出端口</u>的专用计算机，其任务是==转发分组==

**路由选择处理机**：根据所选定的路由选择协议构造出路由表，和相邻路由器交换路由信息而不断地更新和维护路由表

**交换结构**：根据转发表（路由表得来)对分组进行转发

<u>若收到RIP/OSPF分组等，则把分组送往路由选择处理机；若收到数据分组，则查找转发表并输出</u>

<u>路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因</u>

<img src="计算机网络.assets/截屏2022-09-16 22.20.06.png" alt="截屏2022-09-16 22.20.06" style="zoom:25%;" />

|  设备  |               能否互联               |
| :----: | :----------------------------------: |
| 路由器 |   可以互联两个不同网络层协议的网段   |
|  网桥  | 可以互联两个物理层和链路层不同的网段 |
| 集线器 |     不能互联两个物理层不同的网段     |

|            设备            | 能否隔离冲突域 | 能否隔离广播域 |
| :------------------------: | :------------: | :------------: |
| 物理层设备(中继器、集线器) |       ❌        |       ❌        |
|  链路层设备(网桥、交换机)  |       ☑️        |       ❌        |
|     网络层设备(路由器)     |       ☑️        |       ☑️        |

**路由表**：根据路由选择算法得出的，主要用途是路由选择，由==软件实现==

**转发表**：转发表由路由表得来，由==软件或硬件实现==，转发表必须包含完成转发功能所必需的信息，在转发表的每一行必须包含从要到达的目的网络到输出端口和某些MAC地址信息的映射

### 第5章 传输层

`TCP`

==可靠；面向连接；时延大；适用于大文件==

**特点**：1⃣️ ==面向连接==（每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的）

​				2⃣️ ==提供可靠交付的服务==，<u>无差错、不丢失、不重复、按序到达</u>（可靠有序，不丢不重）

​				3⃣️ 提供==全双工通信==		4⃣️ ==面向字节流==（TCP把应用程序交下来的数据看成仅仅是一连串的无结构的字节流）

**首部格式**

<img src="计算机网络.assets/截屏2022-09-18 17.40.58.png" alt="截屏2022-09-18 17.40.58" style="zoom:40%;" />

**序号**：在一个TCP连接中传送的字节流中的每一个字节都按顺序编号，本字段表示本报文段所发送数据的第一个字节的序号

**确认号**：期望收到对方下一个报文段的第一个数据字节的序号；若确认号为N，则证明到序号N-1为止的所有数据都已正确收到

**数据偏移**（首部长度） :TCP报文段的数据起始处距离TCP报文段的起始处有多远，以4B位单位，即1个数值是4B

**紧急位URG**：URG=1时， 标明此报文段中有紧急（高优先级）的数据，应尽快传送，不用在缓存里排队，配合紧急指针字段使用

**确认位ACK**：ACK=1时确认号才有效，在连接建立后所有传送的报文段都必须把ACK置为1

**推送位PSH**：PSH=1时， 接收方尽快交付接收应用进程，不再等到缓存填满再向上交付

**复位RST**：RST=1时， 表明TCP连接中出现严重差错，必须释放连接，然后再重新建立传输链接

**同步位SYN**：SYN=1时， 表明是一个连接请求/连接接受报文

**终止位FIN**：FIN=1时， 表明此报文段发送方数据已发完，要求释放连接

**窗口**：指的是发送本报文段的一方的接收窗口，即现在允许对方发送的数据量

**检验和**：检验首部+数据，检验时要加上12B伪首部，第四个字段为6

**紧急指针**：URG=1时才有意义，指出本报文段中紧急数据的字节数

**选项**：最大报文段长度MSS、窗口扩大、时间戳、选择确认...

**连接管理**

（三次握手）

<img src="计算机网络.assets/截屏2022-09-18 17.58.02.png" alt="截屏2022-09-18 17.58.02" style="zoom:40%;" />

**ROUND 1**：客户端发送连接请求报文段，无应用层数据；SYN=1，seq（首部中的序号）=x(随机)

**ROUND 2**：服务器端为该TCP连接分配缓存和变量，并向客户端返回确认报文段，允许连接，无应用层数据

​						 SYN=1，ACK=1, seq=y(随机)，ack=x+1

**ROUND 3**：客户端为该TCP连接分配缓存和变量，并向服务器端返回确认的确认，可以携带数据

​						  SYN=0，ACK=1, seq=x+1, ack=y+1

（四次挥手）

<img src="计算机网络.assets/截屏2022-09-18 18.06.38.png" alt="截屏2022-09-18 18.06.38" style="zoom:40%;" />

**ROUND 1**：客户端发送连接释放报文段，停止发送数据，主动关闭TCP连接；FIN=1, seq=u

**ROUND 2**：服务器端回送一个确认报文段，客户到服务器这个方向的连接就释放了（半关闭状态）；ACK=1，seq=v，ack=u+1

**ROUND 3**：服务器端发完数据，就发出连接释放报文段，主动关闭TCP连接；FIN=1，ACK=1，seq=w，ack=u+1

**ROUND 4**：客户端回送一个确认报文段，再等到时间等待计时器设置的2MSL （最长报文段寿命）后，连接彻底关闭

​						 ACK=1，seq=u+1， ack=w+1

`UDP`

**特点**：

1⃣️ ==无连接==，减少开销和发送数据之前的时延	2⃣️ 最大努力交付，即==不保证可靠交付==	3⃣️ ==无拥塞控制==，适合很多实时应用

4⃣️ UDP是==面向报文==的（应用层给UDP多长的报文，UDP就照样交递给网络层），**适合小文件或一次性传输少量数据的网络应用**



<img src="计算机网络.assets/截屏2022-09-17 17.26.46.png" alt="截屏2022-09-17 17.26.46" style="zoom:35%;" />

<u>可以没有数据字段</u>，即最少8B；<u>可以没有源端口号</u>，如果不需要对方回消息的话

分用时，找不到对应的目的端口号，就丢弃报文并给发送方发送ICMP“端口不可达”差错报告报文













































### 第6章 应用层

`应用层概述`

**应用层协议定义了**：

1⃣️ 应用进程交换的报文类型，请求还是响应?			2⃣️ 各种报文类型的语法，如报文中的各个字段及其详细描述

3⃣️ 字段的语义，即包含在字段中的信息的含义		 4⃣️ 进程何时、如何发送报文，以及对报文进行响应的规则

**应用层功能**：1⃣️ 文件传输、访问和管理	2⃣️ 电子邮件	3⃣️ 虚拟终端	4⃣️ 查询服务和远程作业登录

**主要协议**：FTP、SMTP、POP3、HTTP、DNS

`C/S模型`

客户与客户之间不能之间通信

`P2P模型`

1⃣️ 每个主机<u>既可以提供服务也可以请求服务</u> 				 2⃣️ 任意端系统/节点之间可以<u>直接通讯</u>

3⃣️ 节点间歇性接入网络	4⃣️ 节点可能改变IP地址	  5⃣️ 可扩展性好	6⃣️ 网络健壮性强

`域名系统`（DNS）

（一个==基于C/S模型==的分布式数据库系统，用于域名和IP地址之间的相互映射；采用==UDP==传输）

==域名在不同时间可以解析出不同的IP地址（如负载均衡）；多个域名可以指向同一台主机IP地址==

<u>用户主机只需要知道本地域名服务器的IP</u>（其他事情都由本地域名服务器完成，并把最后结果返回给用户主机）

<img src="计算机网络.assets/截屏2022-08-24 20.04.30.png" alt="截屏2022-08-24 20.04.30" style="zoom:50%;" />

<img src="计算机网络.assets/截屏2022-08-24 20.10.33.png" alt="截屏2022-08-24 20.10.33" style="zoom:50%;" />

<img src="计算机网络.assets/截屏2022-08-24 20.15.26.png" alt="截屏2022-08-24 20.15.26" style="zoom:50%;" />

（权限域名服务器也称为授权域名服务器）

`文件传输协议`（FTP）

==FTP使用TCP实现可靠传输==；==控制连接始终保持、数据连接保持一会==（数据传完即断开）

**控制连接先于数据连接被建立，并晚于数据连接被释放**

在==服务端==主动方式下==控制连接使用TCP 21端口，数据连接使用TCP 20端口==，被动方式由服务器和客户端自行协商决定

在客户端控制连接和数据连接的端口号都由**系统自动分配**

**FTP传输模式**：1⃣️ <u>文本模式</u>（ASCII模式，以文本序列传输数据）2⃣️ <u>二进制模式</u>（Binary模式，以二进制序列传输数据）

==FTP允许客户指明文件的类型和格式，并允许文件具有存取权限==；<u>匿名FTP访问通常使用anonymous作为用户名</u>

<img src="计算机网络.assets/截屏2022-08-24 20.22.36.png" alt="截屏2022-08-24 20.22.36" style="zoom:50%;" />

`电子邮件`

<img src="计算机网络.assets/截屏2022-08-24 20.31.08.png" alt="截屏2022-08-24 20.31.08" style="zoom:50%;" />

==电子邮件内容包括邮件头和邮件体两部分==

<u>邮件头一部分由系统自动生成（如发信人地址，发送时间），另一部分由发件人输入（收信人地址，邮件主题）</u>

**简单邮件传送协议**（SMTP）

负责发送邮件的SMTP进程就是<u>SMTP客户</u>，负责接收邮件的进程就是<u>SMTP服务器</u>

==TCP连接；端口号25（服务器端）；C/S模式==；				**通信的三个阶段**：$连接建立\to 邮件发送\to 连接释放$

**缺点**： 1⃣️ SMTP不能传送可执行文件或者其他二进制对象  2⃣️ SMTP服务器会拒绝超过一定长度的邮件SMTP

​				 3⃣️ 仅限于传送7位ASCII码，不能传送其他非英语国家的文字（==SMTP、POP3都基于ASCII码==）

​			 （使用**通用因特网邮件扩充（MIME）**使电子邮件系统可以支持声音、图像、视频、多种国家语言）

**邮局协议**（POP3）

==TCP连接；端口号110（服务器端）；C/S模式==；			**工作方式**：1⃣️ 下载并保留（在服务器） 2⃣️ 下载并删除

==IMAP、POP3都使用明文传输密码==

<img src="计算机网络.assets/截屏2022-08-26 17.05.36.png" alt="截屏2022-08-26 17.05.36" style="zoom:50%;" />

（==发送端邮件服务器和接收端邮件服务器之间也使用SMTP==）

**网际报文存取协议**（IMAP）

IMAP协议比POP协议复杂；当用户PC上的IMAP客户程序打开IMAP服务器的邮箱时，用户可以看到邮箱的首部，若用户需要打开某个邮件，该邮件才上传到用户的计算机上；IMAP可以让用户在不同的地方使用不同的计算机随时上网阅读处理邮件，还允许只读取邮件中的某一个部分(先看正文，有WiFi的时候再下载附件)

**基于万维网的电子邮件**

<img src="计算机网络.assets/截屏2022-08-26 17.09.25.png" alt="截屏2022-08-26 17.09.25" style="zoom:55%;" />

`HTTP协议`

==无状态的==（借助Cookie）；==无连接的==（交换HTTP报文前不需要先建立HTTP连接）

==HTTP 1.0只支持非持久连接==（每请求一个对象需要建立一次TCP连接），而==HTTP 1.1的默认方式为持久连接==（keep-alive）















[^1]: 
[^2]: 
[^3]: 

[^4]: 

[^5]: 
[^6]: 

[^7]: 
